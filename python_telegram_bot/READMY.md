<h1 align="center">Telegram-bot Hotels in Travels Bot

[![Telegram URL](https://www.dampftbeidir.de/mediafiles/tpl/icon-telegram.png)](https://t.me/hotels_in_travel_bot) 
</h1>

***

## Краткое описание

[Телеграмм бот](@hotels_in_travel_bot) поможет Вам по определенным запросам и критериям, анализировать текущие предложения по отелям 
и выдавать необходимый результат сделать правильный выбор на сайте [Hotels.com](https://hotels.com/).
<br> Пользователь с помощью специальных команд бота может выполнить следующие действия (получить следующую информацию): <br/>
- Узнать топ самых дешёвых отелей в городе (**команда /lowprice**). 
- Узнать топ самых дорогих отелей в городе (**команда /highprice**). 
- Узнать топ отелей, наиболее подходящих по цене и расположению от центра (самые дешёвые и находятся ближе всего к центру) (**команда /bestdeal**). 
- Узнать историю поиска отелей (**команда /history**)


**Для разработки и функционирования проекта используется открытый API Hotels, который расположен на сайте [rapidapi.com](https://rapidapi.com/apidojo/api/hotels4/).**

***


## Интересные реализации
<ul>
   <li>Вся история поиска пользователя хранится в персональной БД (sqlite3), что позволяет в случае необходимости быстро выводить историю поиска.
   <li>Реализована генерация следующих URL-ссылок
      <ul>
         <li>на страницу объекта размещения (отеля) на Hotels.com</li>
         <li>на страницу Google Maps с точкой на объект размещения в соответствии с его координатами на Hotels Api</li>
      </ul>
   <li> Вывод всех фотографий отеля осуществляется в пагинаторе для удобства просмотра пользователем необходимого количества фотографий
    <li> Ввод даты заезда и выезда реализован через календарь телеграм-бота.
</ul>

***

## Локальная установка
Эти инструкции помогут вам развернуть проект на локальном компьютере для разработки и тестирования

**Перед тем, как начать:**
- Если вы не пользуетесь `Python 3`, вам нужно установить инструмент `virtualenv` при помощи `pip install virtualenv`. 
Если вы используете `Python 3`, у вас уже установлен модуль [venv](https://docs.python.org/3/library/venv.html) в стандартной библиотеке.


### Запуск проекта (на примере Windows)

- Создайте на своем компютере папку проекта
- Склонируйте этот репозиторий в папку проекта `git clone https://github.com/...`
- Создайте файл `.env` и добавьте в него переменные окружения:
- Активируйте виртуальное окружение `pipenv shell`
- Установите все зависимости указанные в файле `requirements.txt`
```
BOT_TOKEN=*Ваш токен для бота, полученный от @BotFather*
RAPID_API_HOST=*Адрес сайта для работы с API Hotels (hotels4.p.rapidapi.com)*
RAPID_API_KEY=*Ваш ключ полученный от API по адресу rapidapi.com/apidojo/api/hotels4/*
```
- Запустите бота командой `python main.py` из Терминала из папки с проектом 

***
## Описание работы команд

### Команда /start 

После ввода команды:
1. Приветствие от телеграм бота 
2. Необходимость нажатия на кнопку *Старт* для начала работы по поиску отелей

### Команда /lowprice (реализована в reply - клавиатуре)

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск
2. Уточнение локации поиска 
3. Запрос даты заезда и выезда с отеля через календарь
4. Количество отелей, которые необходимо вывести в результате (не больше заранее определённого максимума)

### Команда /highprice (реализована в reply - клавиатуре)

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск
2. Уточнение локации поиска 
3. Запрос даты заезда и выезда с отеля через календарь
4. Количество отелей, которые необходимо вывести в результате (не больше заранее определённого максимума)

### Команда /bestdeal (реализована в reply - клавиатуре)

После ввода команды у пользователя запрашивается: 
1. Город, где будет проводиться поиск
2. Уточнение локации поиска 
3. Запрос даты заезда и выезда с отеля через календарь
4. Запрос минимальной цены стоимости проживания за сутки
5. Запрос максимальной цены стоимости прпоживания за сутки
6. Запрос максимального удаления отеля от центра города
7. Количество отелей, которые необходимо вывести в результате (не больше заранее определённого максимума)

### Команда /history (реализована в reply - клавиатуре)

После ввода команды доступны две кнопки для работы с историей поиска.
При нажатии на кнопку *Показать историю поиска* выводится история поиска.
Сама история содержит: 

1. Команду, которую вводил пользователь
2. Город, где проводился поиск
3. Отели, которые были найдены (с гиперссылкой на страницу отеля)   
4. Дату и время ввода команды

При нажатии на кнопку *Очистить историю поиска* телеграм бот очищает историю поиска 
и скрывает сообщения, содержащие историю поиска)


### Команда /help

После ввода команды пользователю выводится список команд бота: 
- /help — помощь по командам бота 
- /lowprice — вывод самых дешёвых отелей в городе
- /highprice — вывод самых дорогих отелей в городе 
- /bestdeal — вывод отелей, наиболее подходящих по цене и расположению от центра
- /history — вывод истории поиска отелей

***

## Описание внешнего вида и UI
Окно Telegram-бота при запущенном Python-скрипте воспринимает следующие команды: 
- /help — помощь по командам бота 
- /lowprice — вывод самых дешёвых отелей в городе
- /highprice — вывод самых дорогих отелей в городе 
- /bestdeal — вывод отелей, наиболее подходящих по цене и расположению от центра
- /history — вывод истории поиска отелей

Для команд lowprice, highprice и bestdeal сообщение с результатом содержит краткую информацию по каждому отелю. 
В эту информацию входит: 
- Фоновая фотография отеля
- Название отеля
- Адрес 
- Рейтинг отеля по оценкам посетителей
- Информацию о количестве звезд отеля
- Расстояние от центра города до отеля
- Цена за сутки проживания
- Цена за период проживания в отеле

Также в выводе к каждому отелю выводятся 3 инлайн - кнопки:
- Кнопка с ссылкой  на страницу Google Maps с точкой на объект размещения в соответствии с его координатами
- Кнопка с ссылкой на страницу отеля на Hotels.com
- Пагинатор с возможностью просмотра фотографий отеля

***
## В разработке использованы

- [Python 3.9](https://www.python.org/)
- [HotelsApi](https://rapidapi.com/apidojo/api/hotels4/)
- [pyTelegramBotAPI](https://pypi.org/project/pyTelegramBotAPI/)
- [requests](https://pypi.org/project/requests/)
- [python-dateutil](https://pypi.org/project/python-dateutil/)
- [python-dotenv](https://pypi.org/project/python-dotenv/)
- [python-telegram-bot-pagination](https://pypi.org/project/python-telegram-bot-pagination/)
- [python-telegram-bot-calendar](https://pypi.org/project/python-telegram-bot-calendar/)
- [loguru](https://pypi.org/project/loguru/)